/**
 * Cryptocurrency Price Prediction Game
 * ---------------------------------------------
 * Version 1.0.0, built on Thursday, August 31, 2017
 * Copyright (c) Financial apps and plugins <mail@webthegap.com>. All rights reserved.
 * Demo: http://webthegap.com/products/cryptocurrency-price-prediction-game
 * Purchase: https://codecanyon.net/user/financialtechnology/portfolio?ref=financialtechnology
 * Like: https://www.facebook.com/financialplugins/
 */
"use strict";!function(t){function o(t){e("New game",t);var o=t.duration||5,n=t.direction||1,s=t.startQuote||NaN,a=o,c=setInterval(function(){"function"==typeof t.onSecondPassed&&(a--,t.onSecondPassed(a))},1e3);setTimeout(function(){if(clearInterval(c),"function"==typeof t.onFinish&&!isNaN(s)){var a=n*(i-s)>0;e("Game finished, direction: {0}, startQuote: {1}, current: {2}, duration: {3}, result: {4}".format(n,s,i,o,a)),t.onFinish(a)}},1e3*o)}function n(t){function o(){e("Making SOCKET connection to "+f),u=io.connect(f),u.on("m",a),u.on("connect",s),u.on("disconnect",c),n(g)}function n(t){e("Subscribing to "+t),u.emit("SubAdd",{subs:[d.format(t)]})}function i(t){e("unsubscribing from "+t),u.emit("SubRemove",{subs:[d.format(t)]})}function s(){e("SOCKET connection OPEN")}function a(o){var n=p(o);e("SOCKET message",n),"function"==typeof t.onTick&&t.onTick(n)}function c(){e("SOCKET connection CLOSED"),o()}function r(t){e("change asset to "+t),u.connected?(i(g),g=t,n(g)):(g=t,o())}function p(t){var o=t.split("~"),n=o.length,e=o[n-1],i=parseInt(e,16),s={},a=0;for(var c in l)0===l[c]?(s[c]=o[a],a++):i&l[c]&&("LASTMARKET"===c?s[c]=o[a]:s[c]=parseFloat(o[a]),a++);return s}var u,l={TYPE:0,MARKET:0,FROMSYMBOL:0,TOSYMBOL:0,FLAGS:0,PRICE:1,BID:2,OFFER:4,LASTUPDATE:8,AVG:16,LASTVOLUME:32,LASTVOLUMETO:64,LASTTRADEID:128,VOLUMEHOUR:256,VOLUMEHOURTO:512,VOLUME24HOUR:1024,VOLUME24HOURTO:2048,OPENHOUR:4096,HIGHHOUR:8192,LOWHOUR:16384,OPEN24HOUR:32768,HIGH24HOUR:65536,LOW24HOUR:131072,LASTMARKET:262144},d="5~CCCAGG~{0}~USD",f=t.url||"",g=t.asset||"";return f&&g&&o(),{changeAsset:r}}function e(){("undefined"!=typeof cppgGlobals&&cppgGlobals.debug||"undefined"!=typeof DEBUG&&DEBUG)&&console.log(arguments)}var i,s,a=30,c=[];t(document).ready(function(){var e=t("#cppg-loader"),r=t("#cppg-game"),p=t("#cppg-wins"),u=t("#cppg-losses"),l=t("#cppg-chart"),d=t("#cppg-quote"),f=t("#cppg-asset"),g=t("#cppg-duration"),h=t("#cppg-positive-result"),m=t("#cppg-negative-result"),O=t(".cppg-result"),T=t("#cppg-buttons-container"),E=t(".cppg-action"),S=t("#cppg-question"),v=t("#cppg-prediction"),C=!1,w=Cookies.getJSON("cppg_stats")||{wins:0,losses:0};p.text(w.wins),u.text(w.losses),f.chosen({width:"9.5rem"}),g.chosen({width:"8rem"});var R=new n({url:"wss://streamer.cryptocompare.com",asset:f.val(),onTick:function(t){var o="undefined"!=typeof t.PRICE?parseFloat(t.PRICE):0;o>0&&(s="undefined"!=typeof i?o-i:0,i=o,s>0?d.addClass("cppg-quote-up"):s<0&&d.addClass("cppg-quote-down"),setTimeout(function(){d.removeClass("cppg-quote-up cppg-quote-down")},500),c.length>a&&c.shift(),c.push(i),d.text(i.format(2)),l.sparkline(c,{type:"line",lineWidth:l.data("line-width"),lineColor:l.data("line-color"),fillColor:l.data("fill-color"),spotColor:l.data("spot-color"),minSpotColor:l.data("min-spot-color"),maxSpotColor:l.data("max-spot-color"),spotRadius:l.data("spot-radius"),highlightLineColor:l.data("highlight-line-color"),tooltipChartTitle:'<span class="cppg-tooltip">'+f.find(":selected").text()+"</span>",width:l.width(),height:l.height(),tooltipFormat:'<span class="cppg-tooltip"><span style="color: {{color}}">&#9679;</span> <b>{{y}}</b></span></span>'}),!C&&c.length>0&&(C=!0,e.hide(),r.show()))}});f.on("change",function(){c=[],R.changeAsset(f.val())}),E.on("click",function(){S.hide(),O.hide(),T.css({opacity:0});var n=t(this),e=parseInt(n.data("direction"),10),s=n.data("text"),a=v.data("text"),c=i,r=f.find(":selected").text();v.html(a.format(r,s,c.format(2),g.val())).show();new o({direction:e,duration:g.val(),startQuote:i,onSecondPassed:function(t){v.html(a.format(r,s,c.format(2),t))},onFinish:function(t){t?(w.wins++,h.html(h.data("text").format(i.format(2))).show(),p.text(parseInt(w.wins,10))):(w.losses++,m.html(m.data("text").format(i.format(2))).show(),u.text(parseInt(w.losses,10))),Cookies.set("cppg_stats",w,{expires:365}),setTimeout(function(){v.hide(),S.show(),O.hide(),T.css({opacity:1})},5e3)}})})}),Number.prototype.format=function(){var t="undefined"!=typeof arguments[0]?arguments[0]:2;return this.toFixed(t)},String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(o,n){return"undefined"!=typeof t[n]?t[n]:o})}}(jQuery);